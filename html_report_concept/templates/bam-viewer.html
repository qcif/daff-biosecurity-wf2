<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BAM Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/igv/dist/igv.min.js"></script>
  </head>
  <body>
    <h1>BAM Alignment Viewer</h1>
    <div id="igv-container" style="width: 100%; height: 500px"></div>
    <script>

      // Store binary data as a JavaScript array (placeholder example)
      const bamBinary = new Uint8Array({{ bam_binary_arr | safe }});
      const baiBinary = new Uint8Array({{ bai_binary_arr | safe }});
      const fastaBinary = new Uint8Array({{ fasta_binary_arr | safe }});

      // Create Blob URLs (works like a file URL)
      const bamBlob = new Blob([bamBinary], { type: "application/octet-stream" });
      const baiBlob = new Blob([baiBinary], { type: "application/octet-stream" });
      const fastaBlob = new Blob([fastaBinary], { type: "text/plain" });

      const urls = {
        bam: URL.createObjectURL(bamBlob),
        bai: URL.createObjectURL(baiBlob),
        fasta: URL.createObjectURL(fastaBlob),
      };

      document.addEventListener("DOMContentLoaded", () => {

        igv.createBrowser(document.getElementById("igv-container"), {
          reference: {
            id: "{{ sample_id }}",
            fastaURL: urls.fasta,
          },
          tracks: [
            {
              type: "alignment",
              format: "bam",
              name: "Consensus alignments",
              url: urls.bam,
              indexURL: urls.bai,
            },
          ],
        });

      });

    </script>
  </body>
</html>
